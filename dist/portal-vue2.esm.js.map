{"version":3,"file":"portal-vue2.esm.js","sources":["../src/index.js"],"sourcesContent":["import Vue from 'vue'\n\n/**\n * 模板容器默认渲染函数\n */\nconst defaultContainerRender = ({ h, template, props }) =>\n  h('div', { class: { 'portal-instance-container': true } }, [h(template, { props })])\n\n/**\n * 存储传入的vue实例属性，通过initVueInstanceProps初始化\n */\nlet vueInstanceProps = {}\n\n/**\n * initVueInstanceProps 用于初始化，可以传入store、i18n等\n * @param {Object} params vue实例对象属性,如store、i18n、router等，container表示模板文件最外层包裹\n */\nexport const initVueInstanceProps = (params = {}) => (vueInstanceProps = params)\n\n/**\n * detectPortalInstances 用于检测portal是否在callback后正确销毁\n * @param {Object} params 参数对象\n * @param {String} params.selectors 查询的css选择器，默认值.portal-instance-container\n */\nexport const detectPortalInstances = ({ selectors = '.portal-instance-container' } = {}) => {\n  const hide = () => {\n    const dom = document.querySelector('#portal-instances-detector')\n    if (dom) {\n      document.body.removeChild(dom)\n    }\n  }\n\n  const show = value => {\n    const dom = document.createElement('div')\n    dom.id = 'portal-instances-detector'\n    dom.style = 'position:fixed; top: 0; right: 0; color: red; font-size: 14px; z-index: 999;'\n    dom.innerHTML = `检测到未销毁的portal实例 <b>${value}</b> 个，请确保portal组件正确使用resolve/reject来结束调用`\n    document.body.appendChild(dom)\n  }\n\n  let prev = 0\n  const detect = () => {\n    const count = document.querySelectorAll(selectors).length\n    if (count === 0) {\n      hide()\n    } else if (count > 0 && count !== prev) {\n      hide()\n      show(count)\n    }\n    prev = count\n    window.requestAnimationFrame(detect)\n  }\n  detect()\n}\n\n/**\n * wrap用于将组件append到body节点\n * @param {Object} template 模板import进来的Vue模板对象\n * @param {Object} data 组件需要的props\n * @param {Object} options 配置项\n * @param {Number} options.unmountDelay 延迟销毁，解决可能出现的动画执行不完就被销毁的情况，单位ms\n * @param {Object} options.vueInstanceProps 用于自定义vue实例对象属性\n * @param {Function} options.vueInstanceProps.containerRender 模板文件最外层包裹容器渲染函数 function({ h, template, props })\n * @returns Promise\n */\nexport const wrap = (template, data = {}, options = {}) => {\n  const { containerRender = defaultContainerRender, ...vips } = {\n    ...vueInstanceProps,\n    ...options.vueInstanceProps,\n  }\n\n  // 声明实例对象变量\n  let extendVm = null\n\n  // 卸载销毁\n  const unmountedNode = () => {\n    setTimeout(() => {\n      extendVm.$destroy()\n      if (document.body.contains(extendVm.$el)) {\n        document.body.removeChild(extendVm.$el)\n      }\n    }, options.unmountDelay || 0)\n  }\n\n  // 返回promise，根据vueInstanceProps传入vue实例对象属性，通过判断 options.vueInstanceProps可以自定义vue实例对象属性\n  const p = new Promise((resolve, reject) => {\n    const Instance = Vue.extend({\n      render(h) {\n        // 创建组件实例\n        const props = {\n          callbackResolve: resolve,\n          callbackReject: reject,\n          ...data,\n        }\n\n        return containerRender({ h, template, props })\n      },\n      ...vips,\n    })\n\n    // 插入dom\n    extendVm = new Instance().$mount()\n    document.body.appendChild(extendVm.$el)\n  })\n\n  // 组件resolve回调\n  const callbackResolve = val => {\n    unmountedNode()\n    return Promise.resolve(val)\n  }\n\n  // 组件reject回调\n  const callbackReject = err => {\n    unmountedNode()\n    return Promise.reject(err)\n  }\n  return p.then(callbackResolve, callbackReject)\n}\n"],"names":["defaultContainerRender","_ref","h","template","props","class","vueInstanceProps","initVueInstanceProps","params","arguments","length","undefined","detectPortalInstances","_ref2","_ref2$selectors","selectors","hide","dom","document","querySelector","body","removeChild","show","value","createElement","id","style","innerHTML","concat","appendChild","prev","detect","count","querySelectorAll","window","requestAnimationFrame","wrap","data","options","_vueInstanceProps$opt","_objectSpread","_vueInstanceProps$opt2","containerRender","vips","_objectWithoutProperties","_excluded","extendVm","unmountedNode","setTimeout","$destroy","contains","$el","unmountDelay","p","Promise","resolve","reject","Instance","Vue","extend","render","callbackResolve","callbackReject","$mount","val","err","then"],"mappings":"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"}